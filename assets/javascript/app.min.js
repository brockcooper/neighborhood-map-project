function appViewModel(){function e(){clearTimeout(l.mapRequestTimeout),google.maps.event.addDomListener(window,"resize",function(){var e=t.getCenter();google.maps.event.trigger(t,"resize"),t.setCenter(e)}),t.controls[google.maps.ControlPosition.TOP_RIGHT].push(r),t.controls[google.maps.ControlPosition.TOP_LEFT].push(a),i.style.marginLeft="15px",t.controls[google.maps.ControlPosition.TOP_LEFT].push(i),google.maps.event.addListener(s,"places_changed",function(){try{var e=s.getPlaces();if(e==[])throw"Could not find results. Please try again!";bounds=y(e),t.fitBounds(bounds),t.setZoom(12);var o={ne:t.getBounds().getNorthEast(),sw:t.getBounds().getSouthWest(),center:t.getBounds().getCenter(),searchTerm:s.gm_accessors_.places.Qc.D};T(o)}catch(n){b(),$("#sidebar").append("<p class='alert'>Could not find results. Please try again!</p>")}}),google.maps.event.addListener(t,"bounds_changed",function(){var e=t.getBounds();s.setBounds(e)})}var o,n,t,a,s,r,i,l=this;this.googleMapMarkers=ko.observableArray(),this.googlePlacesInfo=ko.observableArray(),this.foursquareInfo=ko.observableArray();var g="https://playfoursquare.s3.amazonaws.com/press/2014/foursquare-logomark.png",c="http://images.clipartpanda.com/google-location-icon-whitakergroup-google-location-icon-195x300.png",p="";o=new google.maps.LatLng(40.75,-111.8833),n={center:o,zoom:12,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM,style:google.maps.ZoomControlStyle.SMALL},streetViewControlOptions:{position:google.maps.ControlPosition.LEFT_BOTTOM},mapTypeControl:!1,panControl:!1},t=new google.maps.Map(document.getElementById("map-canvas"),n),a=document.getElementById("pac-input"),r=document.getElementById("sidebar"),s=new google.maps.places.SearchBox(a),i=document.getElementById("menu-open");var u=function(){$("#sidebar").hide(),$("#menu-open").show(),$("#menu-open").css("margin-right","8px")},m=function(){$("#sidebar").show(),$("#menu-open").hide()},d=function(e){var o="",n=e.location;if(!e.formatted_address&&n){for(var t in e.location.formattedAddress)o+=e.location.formattedAddress[t]+" ";o=o.slice(0,-1),p=g}else o=e.formatted_address,p=c;return o},f=function(e){var o="",n="";return e.url?o=e.url:e.formatted_address||(o="https://foursquare.com/v/"+e.id),n=o.length>0?'<a href="'+o+'" target=_blank> '+e.name+"</a>":e.name},h=function(e){var o="";return e.rating?o+="<p> Rating: "+e.rating+"</p>":!1,e.stats?o+="<p> Checkins: "+e.stats.checkinsCount+"</p>":!1,o},v=function(e,o){var n=d(e),t='<h1 class="infoHeader"><button type="button" class="item-button" id="'+o+'"><img class="item-icon" src="'+p+'" /></button>'+f(e)+"</h1><p>"+n+"</p>"+h(e);return t},w=function(e){var o=function(){var o;return e.geometry?(o=e.geometry.location,l.googlePlacesInfo.push(e)):(o=new google.maps.LatLng(e.location.lat,e.location.lng),l.foursquareInfo.push(e)),o},n={url:e.icon?e.icon:g,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)},a=new google.maps.Marker({map:t,icon:n,title:e.name,position:o()});l.googleMapMarkers.push(a);var s=l.googleMapMarkers().length-1,r=v(e,s),i=new google.maps.InfoWindow({content:r,pixelOffset:new google.maps.Size(-25,0)});google.maps.event.addListener(a,"click",function(){i.open(t,a)}),$("#sidebar").append(r+"<hr>")},b=function(){for(var e,o=0;e=l.googleMapMarkers()[o];o++)e.setMap(null);l.googleMapMarkers.removeAll(),l.googlePlacesInfo.removeAll(),l.foursquareInfo.removeAll(),$("#sidebar").empty(),$("#sidebar").append("<img src='assets/img/Cancel.png' class='cancel-icon' />"),$("#sidebar").show(),$("#menu-open").hide(),$("#menu-open").on("click",function(){m()}),$(".cancel-icon").on("click",function(){u()})},y=function(e){if(0!==e.length){var o=new google.maps.LatLngBounds;b();for(var n,t=0;n=e[t];t++)w(n),o.extend(n.geometry.location);return o}},T=function(e){function o(){return $.ajax({url:g,dataType:"json"})}var n=e.searchTerm.replace(/ /g,"+"),t=e.sw.A+","+e.sw.F,a=e.ne.A+","+e.ne.F,s=e.center.A+","+e.center.F,r="WGQH2NSLMADX2E4KOGNMN2LU3WQXTQIHSHA1ZUL0DIR3WCRK",i="IQ4TFNK0IN324QTJLUIJHWWI2HHTC0ZPZKIT5ICWOAQEDA1V",g="https://api.foursquare.com/v2/venues/search?client_id="+r+"&client_secret="+i+"&v=20150601&limit=20&intent=browse&ll="+s+"&ne="+a+"&sw="+t+"&query="+n;o().done(function(e){e=e.response.venues,e.forEach(function(e){w(e),$(".item-button").on("click",function(){var e=$(this).attr("id");google.maps.event.trigger(l.googleMapMarkers()[e],"click")})})}).fail(function(){$("#sidebar").append("<p class='alert'>Could not get Foursquare data. Please try again!</p>"),$(".item-button").on("click",function(){var e=$(this).attr("id");google.maps.event.trigger(l.googleMapMarkers()[e],"click")})})};this.mapRequestTimeout=setTimeout(function(){$("#map-canvas").html("Could not load map. Please try again!")},8e3),e()}ko.applyBindings(new appViewModel);