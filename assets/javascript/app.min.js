function appViewModel(){function e(){clearTimeout(i.mapRequestTimeout),google.maps.event.addDomListener(window,"resize",function(){var e=t.getCenter();google.maps.event.trigger(t,"resize"),t.setCenter(e)}),t.controls[google.maps.ControlPosition.TOP_RIGHT].push(s),t.controls[google.maps.ControlPosition.TOP_LEFT].push(a),google.maps.event.addListener(r,"places_changed",function(){var e=r.getPlaces();bounds=h(e),t.fitBounds(bounds),t.setZoom(12);var o={ne:t.getBounds().getNorthEast(),sw:t.getBounds().getSouthWest(),center:t.getBounds().getCenter(),searchTerm:r.gm_accessors_.places.Qc.D};w(o)}),google.maps.event.addListener(t,"bounds_changed",function(){var e=t.getBounds();r.setBounds(e)})}var o,n,t,a,r,s,i=this;this.googleMapMarkers=ko.observableArray(),this.googlePlacesInfo=ko.observableArray(),this.foursquareInfo=ko.observableArray();var l="https://playfoursquare.s3.amazonaws.com/press/2014/foursquare-logomark.png",g="http://images.clipartpanda.com/google-location-icon-whitakergroup-google-location-icon-195x300.png",c="";o=new google.maps.LatLng(40.75,-111.8833),n={center:o,zoom:12,zoomControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM,style:google.maps.ZoomControlStyle.SMALL},streetViewControlOptions:{position:google.maps.ControlPosition.LEFT_BOTTOM},mapTypeControl:!1,panControl:!1},t=new google.maps.Map(document.getElementById("map-canvas"),n),a=document.getElementById("pac-input"),s=document.getElementById("sidebar"),r=new google.maps.places.SearchBox(a);var p=function(e){var o="",n=e.location;if(!e.formatted_address&&n){for(var t in e.location.formattedAddress)o+=e.location.formattedAddress[t]+" ";o=o.slice(0,-1),c=l}else o=e.formatted_address,c=g;return o},u=function(e){var o="",n="";return e.url?o=e.url:e.formatted_address||(o="https://foursquare.com/v/"+e.id),n=o.length>0?'<a href="'+o+'" target=_blank> '+e.name+"</a>":e.name},m=function(e){var o="";return e.rating?o+="<p> Rating: "+e.rating+"</p>":!1,e.stats?o+="<p> Checkins: "+e.stats.checkinsCount+"</p>":!1,o},d=function(e,o){var n=p(e),t='<h1 class="infoHeader"><button type="button" class="item-button" id="'+o+'"><img class="item-icon" src="'+c+'" /></button>'+u(e)+"</h1><p>"+n+"</p>"+m(e);return t},f=function(e){var o=function(){var o;return e.geometry?(o=e.geometry.location,i.googlePlacesInfo.push(e)):(o=new google.maps.LatLng(e.location.lat,e.location.lng),i.foursquareInfo.push(e)),o},n={url:e.icon?e.icon:l,size:new google.maps.Size(71,71),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34),scaledSize:new google.maps.Size(25,25)},a=new google.maps.Marker({map:t,icon:n,title:e.name,position:o()});i.googleMapMarkers.push(a);var r=i.googleMapMarkers().length-1,s=d(e,r),g=new google.maps.InfoWindow({content:s,pixelOffset:new google.maps.Size(-25,0)});google.maps.event.addListener(a,"click",function(){g.open(t,a)}),$("#sidebar").append(s+"<hr>")},v=function(){for(var e,o=0;e=i.googleMapMarkers()[o];o++)e.setMap(null);i.googleMapMarkers.removeAll(),i.googlePlacesInfo.removeAll(),i.foursquareInfo.removeAll(),$("#sidebar").empty(),$("#sidebar").show()},h=function(e){if(0!==e.length){var o=new google.maps.LatLngBounds;v();for(var n,t=0;n=e[t];t++)f(n),o.extend(n.geometry.location);return o}},w=function(e){function o(){return $.ajax({url:g,dataType:"json"})}var n=e.searchTerm.replace(/ /g,"+"),t=e.sw.A+","+e.sw.F,a=e.ne.A+","+e.ne.F,r=e.center.A+","+e.center.F,s="WGQH2NSLMADX2E4KOGNMN2LU3WQXTQIHSHA1ZUL0DIR3WCRK",l="IQ4TFNK0IN324QTJLUIJHWWI2HHTC0ZPZKIT5ICWOAQEDA1V",g="https://api.foursquare.com/v2/venues/search?client_id="+s+"&client_secret="+l+"&v=20150601&limit=20&intent=browse&ll="+r+"&ne="+a+"&sw="+t+"&query="+n;o().done(function(e){e=e.response.venues,e.forEach(function(e){f(e),$(".item-button").on("click",function(){var e=$(this).attr("id");google.maps.event.trigger(i.googleMapMarkers()[e],"click")})})}).fail(function(){console.log("Could not get Foursquare data. Please try again!"),$(".item-button").on("click",function(){var e=$(this).attr("id");google.maps.event.trigger(i.googleMapMarkers()[e],"click")})})};this.mapRequestTimeout=setTimeout(function(){$("#map-canvas").html("Could not load map. Please try again!")},8e3),e()}ko.applyBindings(new appViewModel);